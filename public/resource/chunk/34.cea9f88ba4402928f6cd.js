webpackJsonp([34],{1997:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(208),l=i(o),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();n(302);var u=n(5),d=i(u),f=n(1998),p=i(f),h=n(2004),y=i(h);n(2005);var m=function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={recording:!1,playing:!1,playingAudio:!1,audioUrl:""},n.play=n.play.bind(n),n.startRecord=n.startRecord.bind(n),n.stopRecord=n.stopRecord.bind(n),n.replay=n.replay.bind(n),n.playEnd=n.playEnd.bind(n),n}return s(t,e),c(t,[{key:"componentDidMount",value:function(){var e=sessionStorage.getItem(this.props.id);this.props.recordMode||(e=this.props.audioUrl),this.setState({audioUrl:e}),y.default.stop(),this.refs.audioPlayer.pause()}},{key:"play",value:function(){this.setState({playingAudio:!this.state.playingAudio,playing:!1}),this.refs.audioPlayer.pause(),this.state.playingAudio?y.default.stop():y.default.play(this.props.url)}},{key:"replay",value:function(){this.setState({playing:!this.state.playing,playingAudio:!1}),y.default.stop(),this.state.playing?this.refs.audioPlayer.pause():this.refs.audioPlayer.play()}},{key:"playEnd",value:function(){this.setState({playing:!1})}},{key:"startRecord",value:function(){this.setState({recording:!0,playing:!1,playingAudio:!1}),this.refs.audioPlayer.pause(),y.default.stop()}},{key:"stopRecord",value:function(){this.setState({recording:!1})}},{key:"getUploadFile",value:function(e,t){this.stopRecord(),this.setState({audioUrl:e}),sessionStorage.setItem(this.props.id,e),"function"==typeof this.props.finishedOneSentence&&this.props.finishedOneSentence(e,t)}},{key:"to2Len",value:function(e){return e>>>=0,e>=10?String(e):"0"+e}},{key:"sec2Min",value:function(e){return e<60?e+"秒":this.to2Len(parseInt(e/60))+"分"+this.to2Len(e%60)+"秒"}},{key:"render",value:function(){var e=this.state,t=e.recording,n=e.playing,i=e.audioUrl,r=e.playingAudio;return d.default.createElement("div",{className:"article-sentence"},d.default.createElement("audio",{ref:"audioPlayer",src:this.state.audioUrl,onEnded:this.playEnd}),d.default.createElement("div",{onClick:this.showBtns},d.default.createElement("div",{className:"english-sentence"},this.props.english),d.default.createElement("div",{className:"chinese-sentence"},this.props.chinese)),d.default.createElement("div",{className:"operate-btns"},d.default.createElement(l.default,{className:"play-audio",type:"primary",shape:"circle",size:"large",icon:r?"pause-circle-o":"play-circle-o",title:"播放句子音频",disabled:t,onClick:this.play}),this.props.recordMode&&d.default.createElement(p.default,{startRecord:this.startRecord,stopRecord:this.stopRecord,uploadAudioFile:this.getUploadFile.bind(this)}),d.default.createElement(l.default,{className:"play-audio",type:"primary",shape:"circle",size:"large",icon:n?"pause":"reload",title:"播放我的录音",disabled:t||!i,onClick:this.replay}),!this.props.recordMode&&d.default.createElement("span",{style:{marginLeft:"15px"}},"用时:",this.sec2Min(this.props.time))))}}]),t}(u.Component),_=m;t.default=_,function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(m,"Sentence","D:/Work/yjyx_web/src/components/student/task/english-read/sentence.js"),__REACT_HOT_LOADER__.register(_,"default","D:/Work/yjyx_web/src/components/student/task/english-read/sentence.js"))}()},2004:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(35),a=i(r);n(36);var s=n(751),o=i(s),l={audio:null,audioContext:new AudioContext};l.play=function(e){var t=this;this.fetchBlob(e).then(function(e){t.decodeBlob(e.data)})},l.fetchBlob=function(e){return(0,o.default)({method:"get",url:e,responseType:"blob"})},l.getAmrArray=function(e){return new Promise(function(t){var n=new FileReader;n.onload=function(){t(new Uint8Array(this.result))},n.readAsArrayBuffer(e)})},l.decodeBlob=function(e){var t=this;this.getAmrArray(e).then(function(e){var n=AMR.decode(e);if(!n)return void a.default.error("解码失败!");t.playPCM(n)})},l.playPCM=function(e){var t=this.audioContext;this.stop(),this.audio=t.createBufferSource();var n=t.createBuffer(1,e.length,8e3);n.copyToChannel?n.copyToChannel(e,0,0):n.getChannelData(0).set(e),this.audio.buffer=n,this.audio.connect(t.destination),this.audio.start()},l.stop=function(){this.audio&&this.audio.stop()};var c=l;t.default=c,function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(l,"player","D:/Work/yjyx_web/src/components/common/audioPlayer/index.js"),__REACT_HOT_LOADER__.register(c,"default","D:/Work/yjyx_web/src/components/common/audioPlayer/index.js"))}()},2005:function(e,t,n){var i=n(2006);"string"==typeof i&&(i=[[e.i,i,""]]);var r={};r.transform=void 0,n(117)(i,r),i.locals&&(e.exports=i.locals)},2006:function(e,t,n){t=e.exports=n(116)(void 0),t.push([e.i,".article-sentence{margin:0 15px;padding-bottom:10px;border-bottom:1px solid #666;text-align:center}.article-sentence .chinese-sentence,.article-sentence .english-sentence{color:#666;font-weight:500;font-size:15px}.article-sentence .operate-btns{margin-top:5px;overflow:hidden;-webkit-transition:height .3s;transition:height .3s;color:#666}.hide-recorder{width:0;height:0}",""])},2293:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2294),r=function(e){return e&&e.__esModule?e:{default:e}}(i),a=r.default;t.default=a,function(){"undefined"!=typeof __REACT_HOT_LOADER__&&__REACT_HOT_LOADER__.register(a,"default","D:/Work/yjyx_web/src/containers/student/english-read/index.js")}()},2294:function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(336),l=i(o),c=n(35),u=i(c),d=n(208),f=i(d),p=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();n(337),n(36),n(302);var h=n(5),y=i(h),m=n(751),_=(i(m),n(1997)),v=i(_),x=n(23),g=n(86),b=i(g);n(2298);var k=function(e){function t(e){r(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return["prevArticle","nextArticle","prevSentence","nextSentence","submit","doSubmit","cancelSubmit"].forEach(function(e){n[e]=n[e].bind(n)}),n.state={taskDetail:{},bookTextList:[],currentArticleIndex:0,currentSentenceIndex:0,articleNum:0,audioUrl:"",sentenceNum:0,readNum:0,spendTime:0,spendTimeStr:"00:00:00",voiceList:[],showModal:!1},n}return s(t,e),p(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params;x.Networker.snatch(b.default.tasks2,"GET",{action:"get_one_student_one_task_detail_info",taskid:t.taskId}).then(function(t){e.handleResponse(t)}),this.timer=setInterval(function(){var t=++e.state.spendTime,n=e.convertSeconds(t);e.setState({spendTime:t,spendTimeStr:n})},1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"to2Len",value:function(e){return e>>>=0,e>=10?String(e):"0"+e}},{key:"convertSeconds",value:function(e){return this.to2Len(e/3600)+":"+this.to2Len(e%3600/60)+":"+this.to2Len(e%3600%60)}},{key:"handleResponse",value:function(e){for(var t=this,n=e.task_detail_info.booktext_list,i=n.length,r=new Array(i),a=0,s=void 0,o=0;o<i;o++)!function(e){s=n[e].sentence_summary,a+=s.length,r[e]=[],s.forEach(function(n){n.id=t.guid(),r[e].push({url:"",time:0})})}(o);this.setState({taskDetail:e.task_detail_info,bookTextList:n,articleNum:i,sentenceNum:a,voiceList:r})}},{key:"guid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}},{key:"handleSentenceButtons",value:function(){var e=this.state,t=e.bookTextList,n=e.currentArticleIndex,i=e.currentSentenceIndex,r=t[n].sentence_summary,a=r.length,s=[y.default.createElement(f.default,{type:"ghost",key:"0",className:"prev-sentence",onClick:this.prevSentence},"上一句"),y.default.createElement(f.default,{type:"ghost",key:"1",className:"next-sentence",onClick:this.nextSentence},"下一句")];return 0===i&&a-1===i?s=[]:0===i?s.shift():a-1===i&&s.pop(),s}},{key:"nextSentence",value:function(){this.setState({currentSentenceIndex:this.state.currentSentenceIndex+1})}},{key:"prevSentence",value:function(){this.setState({currentSentenceIndex:this.state.currentSentenceIndex-1})}},{key:"handleButtons",value:function(){var e=this.state.currentArticleIndex,t=[y.default.createElement(f.default,{type:"ghost",key:"0",onClick:this.prevArticle},"上一篇"),y.default.createElement(f.default,{type:"ghost",key:"1",onClick:this.nextArticle},"下一篇"),y.default.createElement(f.default,{type:"ghost",key:"2",onClick:this.submit},"提交")];return 0===e&&e===this.state.articleNum-1?t=t.splice(2,1):0===e?t.shift():e===this.state.articleNum-1&&t.splice(1,1),t}},{key:"prevArticle",value:function(){this.setState({currentArticleIndex:this.state.currentArticleIndex-1,currentSentenceIndex:0})}},{key:"nextArticle",value:function(){this.setState({currentArticleIndex:this.state.currentArticleIndex+1,currentSentenceIndex:0})}},{key:"finishedOneSentence",value:function(e,t){var n=this.state,i=n.currentArticleIndex,r=n.currentSentenceIndex,a=n.voiceList;a[i][r]={url:e,time:t},this.setState({voiceList:a,readNum:++this.state.readNum})}},{key:"submit",value:function(){var e=this.state.sentenceNum-this.state.readNum;if(e)return void u.default.error("还有"+e+"个句子没有跟读");this.setState({showModal:!0})}},{key:"doSubmit",value:function(){var e=this,t=this.state.voiceList,n=this.state.spendTime,i=JSON.stringify({voice_list:t,spendtime:n}),r=JSON.stringify({correct:0,wrong:0}),a=+this.props.match.params.taskId,s={action:"task_other_save_result",result:i,summary:r,taskid:a,submit:"true",spendtime:n,task_type:4};x.Networker.snatch(b.default.tasks,"POST",s).then(function(t){console.log(t),t.retcode?u.default.error(t.msg):(u.default.success("别忘了提醒家长及时检查老师才能收到作业哦！"),e.props.history.push("/student/english-finished-info/4/"+a))}).catch(function(e){console.log(e)})}},{key:"cancelSubmit",value:function(){this.setState({showModal:!1})}},{key:"render",value:function(){var e=this.state.bookTextList[this.state.currentArticleIndex],t=void 0,n=void 0,i=void 0,r=void 0;return e?(n=e.name,i=e.img,t=e.sentence_summary[this.state.currentSentenceIndex],r=this.handleSentenceButtons(),y.default.createElement("div",{className:"article-detail"},y.default.createElement("div",null,y.default.createElement("div",{className:"article-cover"},y.default.createElement("span",{className:"spend-time"},"用时: ",this.state.spendTimeStr),y.default.createElement("h4",null,n),y.default.createElement("img",{src:i,alt:"文章封面"}),y.default.createElement("p",{className:"article-summary"},e.summary)),y.default.createElement("div",{className:"sentence-list"},y.default.createElement(v.default,{id:t.id,key:t.id,recordMode:!0,chinese:t.sentence,english:t.english,url:t.voice,finishedOneSentence:this.finishedOneSentence.bind(this)})),y.default.createElement("div",{className:"change-sentence",style:{display:r.length?"block":"none"}},r)),y.default.createElement("div",null,this.handleButtons()),y.default.createElement(l.default,{title:"作业提交",visible:this.state.showModal,onOk:this.doSubmit,onCancel:this.cancelSubmit},y.default.createElement("p",null,"确定提交作业?")))):null}}]),t}(h.Component),E=k;t.default=E,function(){"undefined"!=typeof __REACT_HOT_LOADER__&&(__REACT_HOT_LOADER__.register(k,"English","D:/Work/yjyx_web/src/components/student/task/english-read/index.js"),__REACT_HOT_LOADER__.register(E,"default","D:/Work/yjyx_web/src/components/student/task/english-read/index.js"))}()},2298:function(e,t,n){var i=n(2299);"string"==typeof i&&(i=[[e.i,i,""]]);var r={};r.transform=void 0,n(117)(i,r),i.locals&&(e.exports=i.locals)},2299:function(e,t,n){t=e.exports=n(116)(void 0),t.push([e.i,".article-detail{position:relative;margin:40px auto;background-color:#fff;width:100%;max-width:1100px;-webkit-box-shadow:0 0 0 16px hsla(0,0%,100%,.2);box-shadow:0 0 0 16px hsla(0,0%,100%,.2);border-radius:20px}.article-detail :last-child{text-align:center}.article-detail :last-child button{margin:10px}.article-detail .start-record button{margin:0}.article-detail .article-cover{text-align:center;padding:15px}.article-detail .article-cover h4{margin-bottom:10px;font-size:16px;font-weight:700}.article-detail .change-sentence{overflow:hidden;margin:0 15px;border-bottom:1px solid #666}.article-detail .change-sentence .next-sentence{float:right}.article-detail .change-sentence .prev-sentence{float:left}.article-detail .article-summary{padding-bottom:15px;border-bottom:1px solid #666}.article-detail .spend-time{display:inline-block;position:absolute;right:0;width:100px;text-align:left}",""])}});